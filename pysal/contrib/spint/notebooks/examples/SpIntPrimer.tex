





% Default to the notebook output style


% Inherit from the specified cell style.




    
\documentclass[11pt]{article}

    
    \usepackage[authoryear]{natbib}
    \usepackage[T1]{fontenc}
    % Nicer default font than Computer Modern for most use cases
    \usepackage{palatino}

    % Basic figure setup, for now with no caption control since it's done
    % automatically by Pandoc (which extracts ![](path) syntax from Markdown).
    \usepackage{graphicx}
    % We will generate all images so they have a width \maxwidth. This means
    % that they will get their normal width if they fit onto the page, but
    % are scaled down if they would overflow the margins.
    \makeatletter
    \def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth
    \else\Gin@nat@width\fi}
    \makeatother
    \let\Oldincludegraphics\includegraphics
    % Set max figure width to be 80% of text width, for now hardcoded.
    \renewcommand{\includegraphics}[1]{\Oldincludegraphics[width=.8\maxwidth]{#1}}
    % Ensure that by default, figures have no caption (until we provide a
    % proper Figure object with a Caption API and a way to capture that
    % in the conversion process - todo).
    \usepackage{caption}
    \DeclareCaptionLabelFormat{nolabel}{}
    \captionsetup{labelformat=nolabel}

    \usepackage{adjustbox} % Used to constrain images to a maximum size 
    \usepackage{xcolor} % Allow colors to be defined
    \usepackage{enumerate} % Needed for markdown enumerations to work
    \usepackage{geometry} % Used to adjust the document margins
    \usepackage{amsmath} % Equations
    \usepackage{amssymb} % Equations
    \usepackage{textcomp} % defines textquotesingle
    % Hack from http://tex.stackexchange.com/a/47451/13684:
    \AtBeginDocument{%
        \def\PYZsq{\textquotesingle}% Upright quotes in Pygmentized code
    }
    \usepackage{upquote} % Upright quotes for verbatim code
    \usepackage{eurosym} % defines \euro
    \usepackage[mathletters]{ucs} % Extended unicode (utf-8) support
    \usepackage[utf8x]{inputenc} % Allow utf-8 characters in the tex document
    \usepackage{fancyvrb} % verbatim replacement that allows latex
    \usepackage{grffile} % extends the file name processing of package graphics 
                         % to support a larger range 
    % The hyperref package gives us a pdf with properly built
    % internal navigation ('pdf bookmarks' for the table of contents,
    % internal cross-reference links, web links for URLs, etc.)
    \usepackage{hyperref}
    \usepackage{longtable} % longtable support required by pandoc >1.10
    \usepackage{booktabs}  % table support for pandoc > 1.12.2
    \usepackage[normalem]{ulem} % ulem is needed to support strikethroughs (\sout)
                                % normalem makes italics be italics, not underlines
    
\usepackage{authblk}
    
    
    % Colors for the hyperref package
    \definecolor{urlcolor}{rgb}{0,.145,.698}
    \definecolor{linkcolor}{rgb}{.71,0.21,0.01}
    \definecolor{citecolor}{rgb}{.12,.54,.11}

    % ANSI colors
    \definecolor{ansi-black}{HTML}{3E424D}
    \definecolor{ansi-black-intense}{HTML}{282C36}
    \definecolor{ansi-red}{HTML}{E75C58}
    \definecolor{ansi-red-intense}{HTML}{B22B31}
    \definecolor{ansi-green}{HTML}{00A250}
    \definecolor{ansi-green-intense}{HTML}{007427}
    \definecolor{ansi-yellow}{HTML}{DDB62B}
    \definecolor{ansi-yellow-intense}{HTML}{B27D12}
    \definecolor{ansi-blue}{HTML}{208FFB}
    \definecolor{ansi-blue-intense}{HTML}{0065CA}
    \definecolor{ansi-magenta}{HTML}{D160C4}
    \definecolor{ansi-magenta-intense}{HTML}{A03196}
    \definecolor{ansi-cyan}{HTML}{60C6C8}
    \definecolor{ansi-cyan-intense}{HTML}{258F8F}
    \definecolor{ansi-white}{HTML}{C5C1B4}
    \definecolor{ansi-white-intense}{HTML}{A1A6B2}

    % commands and environments needed by pandoc snippets
    % extracted from the output of `pandoc -s`
    \providecommand{\tightlist}{%
      \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
    \DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
    % Add ',fontsize=\small' for more characters per line
    \newenvironment{Shaded}{}{}
    \newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{\textbf{{#1}}}}
    \newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.56,0.13,0.00}{{#1}}}
    \newcommand{\DecValTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\FloatTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\CharTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\StringTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\CommentTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textit{{#1}}}}
    \newcommand{\OtherTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{{#1}}}
    \newcommand{\AlertTok}[1]{\textcolor[rgb]{1.00,0.00,0.00}{\textbf{{#1}}}}
    \newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.02,0.16,0.49}{{#1}}}
    \newcommand{\RegionMarkerTok}[1]{{#1}}
    \newcommand{\ErrorTok}[1]{\textcolor[rgb]{1.00,0.00,0.00}{\textbf{{#1}}}}
    \newcommand{\NormalTok}[1]{{#1}}
    
    % Additional commands for more recent versions of Pandoc
    \newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.53,0.00,0.00}{{#1}}}
    \newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.73,0.40,0.53}{{#1}}}
    \newcommand{\ImportTok}[1]{{#1}}
    \newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.73,0.13,0.13}{\textit{{#1}}}}
    \newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \newcommand{\VariableTok}[1]{\textcolor[rgb]{0.10,0.09,0.49}{{#1}}}
    \newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{\textbf{{#1}}}}
    \newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.40,0.40,0.40}{{#1}}}
    \newcommand{\BuiltInTok}[1]{{#1}}
    \newcommand{\ExtensionTok}[1]{{#1}}
    \newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.74,0.48,0.00}{{#1}}}
    \newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.49,0.56,0.16}{{#1}}}
    \newcommand{\InformationTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \newcommand{\WarningTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    
    
    % Define a nice break command that doesn't care if a line doesn't already
    % exist.
    \def\br{\hspace*{\fill} \\* }
    % Math Jax compatability definitions
    \def\gt{>}
    \def\lt{<}
    % Document parameters
    
    
    

    % Pygments definitions
    
\makeatletter
\def\PY@reset{\let\PY@it=\relax \let\PY@bf=\relax%
    \let\PY@ul=\relax \let\PY@tc=\relax%
    \let\PY@bc=\relax \let\PY@ff=\relax}
\def\PY@tok#1{\csname PY@tok@#1\endcsname}
\def\PY@toks#1+{\ifx\relax#1\empty\else%
    \PY@tok{#1}\expandafter\PY@toks\fi}
\def\PY@do#1{\PY@bc{\PY@tc{\PY@ul{%
    \PY@it{\PY@bf{\PY@ff{#1}}}}}}}
\def\PY#1#2{\PY@reset\PY@toks#1+\relax+\PY@do{#2}}

\expandafter\def\csname PY@tok@gd\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.63,0.00,0.00}{##1}}}
\expandafter\def\csname PY@tok@gu\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.50,0.00,0.50}{##1}}}
\expandafter\def\csname PY@tok@gt\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.27,0.87}{##1}}}
\expandafter\def\csname PY@tok@gs\endcsname{\let\PY@bf=\textbf}
\expandafter\def\csname PY@tok@gr\endcsname{\def\PY@tc##1{\textcolor[rgb]{1.00,0.00,0.00}{##1}}}
\expandafter\def\csname PY@tok@cm\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@vg\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@vi\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@mh\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@cs\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@ge\endcsname{\let\PY@it=\textit}
\expandafter\def\csname PY@tok@vc\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@il\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@go\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.53,0.53,0.53}{##1}}}
\expandafter\def\csname PY@tok@cp\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.74,0.48,0.00}{##1}}}
\expandafter\def\csname PY@tok@gi\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.63,0.00}{##1}}}
\expandafter\def\csname PY@tok@gh\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,0.50}{##1}}}
\expandafter\def\csname PY@tok@ni\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.60,0.60,0.60}{##1}}}
\expandafter\def\csname PY@tok@nl\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.63,0.63,0.00}{##1}}}
\expandafter\def\csname PY@tok@nn\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\expandafter\def\csname PY@tok@no\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.53,0.00,0.00}{##1}}}
\expandafter\def\csname PY@tok@na\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.49,0.56,0.16}{##1}}}
\expandafter\def\csname PY@tok@nb\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@nc\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\expandafter\def\csname PY@tok@nd\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.67,0.13,1.00}{##1}}}
\expandafter\def\csname PY@tok@ne\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.82,0.25,0.23}{##1}}}
\expandafter\def\csname PY@tok@nf\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\expandafter\def\csname PY@tok@si\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.73,0.40,0.53}{##1}}}
\expandafter\def\csname PY@tok@s2\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@nt\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@nv\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@s1\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@ch\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@m\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@gp\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,0.50}{##1}}}
\expandafter\def\csname PY@tok@sh\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@ow\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.67,0.13,1.00}{##1}}}
\expandafter\def\csname PY@tok@sx\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@bp\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@c1\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@o\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@kc\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@c\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@mf\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@err\endcsname{\def\PY@bc##1{\setlength{\fboxsep}{0pt}\fcolorbox[rgb]{1.00,0.00,0.00}{1,1,1}{\strut ##1}}}
\expandafter\def\csname PY@tok@mb\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@ss\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@sr\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.40,0.53}{##1}}}
\expandafter\def\csname PY@tok@mo\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@kd\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@mi\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@kn\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@cpf\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@kr\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@s\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@kp\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@w\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.73,0.73}{##1}}}
\expandafter\def\csname PY@tok@kt\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.69,0.00,0.25}{##1}}}
\expandafter\def\csname PY@tok@sc\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@sb\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@k\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@se\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.73,0.40,0.13}{##1}}}
\expandafter\def\csname PY@tok@sd\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}

\def\PYZbs{\char`\\}
\def\PYZus{\char`\_}
\def\PYZob{\char`\{}
\def\PYZcb{\char`\}}
\def\PYZca{\char`\^}
\def\PYZam{\char`\&}
\def\PYZlt{\char`\<}
\def\PYZgt{\char`\>}
\def\PYZsh{\char`\#}
\def\PYZpc{\char`\%}
\def\PYZdl{\char`\$}
\def\PYZhy{\char`\-}
\def\PYZsq{\char`\'}
\def\PYZdq{\char`\"}
\def\PYZti{\char`\~}
% for compatibility with earlier versions
\def\PYZat{@}
\def\PYZlb{[}
\def\PYZrb{]}
\makeatother


    % Exact colors from NB
    \definecolor{incolor}{rgb}{0.0, 0.0, 0.5}
    \definecolor{outcolor}{rgb}{0.545, 0.0, 0.0}



    
    % Prevent overflowing lines due to hard-to-break entities
    \sloppy 
    % Setup hyperref package
    \hypersetup{
      breaklinks=true,  % so long urls are correctly broken across lines
      colorlinks=true,
      urlcolor=urlcolor,
      linkcolor=linkcolor,
      citecolor=citecolor,
      }
    % Slightly bigger margins than the latex defaults
    
    \geometry{verbose,tmargin=1in,bmargin=1in,lmargin=1in,rmargin=1in}
    
\usepackage{titling}    
%\setlength\thanksmarkwidth{.5em}
%\setlength\thanksmargin{-\thanksmarkwidth}
    \begin{document}
    
    \title{\texorpdfstring{A primer for working with the
\textbf{\emph{Sp}}atial \textbf{\emph{Int}}eraction modeling (SpInt)
module in the python spatial analysis library
(PySAL)}{A primer for working with the Spatial Interaction modeling (SpInt) module in the python spatial analysis library (PySAL)}}\label{a-primer-for-working-with-the-spatial-interaction-modeling-spint-module-in-the-python-spatial-analysis-library-pysal}

\author{Taylor Oshan\thanks{Email: toshan@asu.edu\\
\hspace*{2.0em}Affiliation: School of Geographical Sciences and Urban Planning, Arizona StateUniversity}}

    \maketitle
    




    \section{Introduction}\label{introduction}

    Spatial interaction modeling involves the analysis of flows from an
origin to a destination, either over physical space (i.e., migration) or
through abstract space (i.e., telecommunication). Despite being a
fundamental technique to many geographic disciplines, there is relatively
little software available to carry out spatial interaction modeling and
the analysis of flow data, especially in the realm of free and open source software. Therefore, the purpose of this primer is to
provide an overview of the recently developed spatial interaction
modeling (SpInt) module\footnote{This primer is based on the xx.xx.xx release of PySAL} of the python spatial analysis library (PySAL)\footnotemark. First, the current framework of the module will be highlighted. Next,
the main functionality of the module will be illustrated using migration
flows with a dataset previously used for spatial interaction modeling
tutorials in the R programming environment \citep{dennett_estimating_2012}. Finally, some future
additions are discussed.

\footnotetext{http://pysal.github.io/}


    \section{The SpInt framework}\label{the-spint-framework}

    \subsection{Modeling framework}\label{modeling-framework}

    The core purpose of the SpInt module is to provide the functionality to
calibrate spatial interaction models. Since the ``family'' of spatial
interaction models put forth by Wilson \citep{wilson_family_1971} are perhaps the
most popular, they were chosen as the starting point of the module.
Consider the basic gravity model \citep{fotheringham_spatial_1989},

\[T_{ij} = k\frac{V_{i}^\mu W_{j}^\alpha}{d_{ij}^\beta} \quad(1)\]

where

\begin{itemize}
\item
  \(T_{ij}\) = an \(n \times m\) matrix of flows between \(n\) origins
  (subscripted by \(i\)) to \(m\) destinations (subscripted by \(j\))
\item
  \(V\) = an \(n \times p\) and vector of \(p\) origin attributes
  describing the emissiveness of \(i\)
\item
  \(W\) = an \(m \times p\) vector of \(p\) destination attributes
  describing the attractiveness of \(j\)
\item
  \(d\) = an \(n \times m\) matrix of the costs to overcome the physical
  separation between \(i\) and \(j\) (usually distance or time)
\item
  \(k\) = a scaling factor to be estimated to ensure the total observed
  and predicted flows are consistent
\item
  \(\mu\) = a \(p \times 1\) vector of parameters representing the
  effect of \(p\) origin attributes on flows
\item
  \(\alpha\) = a \(p \times 1\) vector of parameters representing the
  effect of \(p\) destination attributes on flows
\item
  \(\beta\) = a parameter representing the effect of
  movement costs on flows.
\end{itemize}

When data for \(T\), \(V\), \(W\), and \(d\) are available we can
estimate the model parameters (also called calibration), which summarize
the effect that each model component contributes towards explaining the
system of known flows (\(T\)). In contrast, known parameters can be used
to predict unknown flows when there are deviations in model components
(\(V\), \(W\), and \(d\)) or the set of locations in the system are
altered.

Using an entropy-maximizing framework, Wilson derives a more informative
and flexible ``family'' of four spatial interaction models \citep{wilson_family_1971}.
 This framework seeks to assign flows between a set of origins and
destinations by finding the most probable configuration of flows out of
all possible configurations, without making any additional assumptions.
By using a common optimization problem and including information about
the total inflows and outflows at each location (also called
constraints), the following ``family'' of models can be obtained,

\[
\begin{align}
&Unconstrained \  \\
&Tij = V_{i}^\mu W_{j}^\alpha  f(d_{ij}) \quad & (2) \\
\\
&Production-constrained \\
&T_{ij} = A_{i}O_{i}W_{j}^\alpha f(d_{ij}) \quad & (3) \\
&A_{i} = \sum_{j} W_{j}^\alpha f(d_{ij}) \quad & (3a) \\
\\
&Attraction-constrained \\
&T_{ij} = B_{j}D_{j}V_{i}^\mu f(d_{ij}) \quad & (4) \\
&B_{j} = \sum_{i} V_{i}^\mu f(d_{ij}) \quad & (4a) \\
\\
&Doubly-constrained \\
&T_{ij} = A_{i}B_{j}O_{i}D_{j}f(d_{ij}) \quad & (5) \\
&A_{i} = \sum_{j} W_{j}^\alpha B_{j} D_{j} f(d_{ij}) \quad & (5a) \\
&B_{j} = \sum_{i} V_{i}^\mu A_{i} O_{i} f(d_{ij}) \quad & (5b)
\end{align}
\]

where

\begin{itemize}
\item
  \(O_{i}\) = an \(n \times 1\) vector of the total number of flows
  emanating from origin \(i\)
\item
  \(D_{j}\) = an \(m \times 1\) vector of the total number of flows
  terminating at destination \(j\)
\item
  \(A_{i}\) = an \(n \times 1\) vector of the origin balancing factors
  that ensures the total out-flows are preserved in the predicted flows
\item
  \(B_{j}\) = an \(m \times 1\) vector of the destination balancing
  factors that ensures the total in-flows are preserved in the predicted
  flows
\item
  \(f(d_{ij})\) = a function of cost or distance, referred to as the
  distance-decay function. Most commonly, this is an exponential or power
  function given by,
\end{itemize}
%
\[
\begin{align}
&Power\\
&f(d_{ij}) = d_{ij}^\beta \quad & (6) \\
\\
&Exponential \\
&f(d_{ij}) = exp(\beta*d_{ij}) \quad & (7) \\
\end{align}
\]
%
where \(\beta\) is expected to take a negative value. Different
distance-decay functions assume different responses to the increasing
costs associated with moving to more distant locations. Of note is that
the unconstrained model with a power function distance-decay is
equivalent to the basic gravity model in equation (2), except that the
scaling factor, \(k\), is not included. In fact, there is no scaling
factor in any of the members of the family of maximum entropy models
because there is a total trip constraint implied in their derivation
and subsequently their calibration \citep{fotheringham_spatial_1989}.
Another aside is that in the doubly-constrained maximum entropy model,
the values for \(A_{i}\) and \(B_{j}\) are dependent upon each other and
may need to be computed iteratively depending on calibration technique.
It is also usually assumed that all locations are both origins and
destinations (i.e., \(n=m\)) for doubly-constrained models.

Each member of the family of models provides a different system
structure, which can be chosen depending on the available data or the
specific research question at hand. The so-called unconstrained model
does not conserve the total inflows or outflows during parameter
estimation. The production-constrained and attraction-constrained models
conserve either the number of total inflows or outflows, respectively,
and are therefore useful for building models that allocate flows either
to a set of origins or to a set of destinations. Finally, the
doubly-constrained model conserves both the inflows and the outflows at
each location during model calibration. The quantity of explanatory
information provided by each model is given by the number of parameters
it provides. As such, the unconstrained model provides the most
information, followed by the two singly-constrained models, with the
doubly-constrained model providing the least information. Conversely,
the model's predictive power increases with higher quantities of
built-in information (i.e.~total in or out-flows) so that the
doubly-constrained model usually provides the most accurate predictions,
followed by the two singly-constrained models, and the unconstrained
model supplying the weakest predictions \citep{fotheringham_spatial_1989}.

    \subsection{Calibration framework}\label{calibration-framework}

    Spatial interaction models are often calibrated via linear programming,
nonlinear optimization, or, increasingly more often, through linear
regression. Given the flexibility and extendability of a regression
framework it was chosen as the primary model calibration technique
within the SpInt module. By taking the natural logarithm of both sides
of a spatial interaction model, say the basic gravity model, is is
possible to obtain the so-called log-linear or log-normal spatial
interaction model,

\[
\begin{align}
& Power-function \\
&\ln{T_{ij}} = k + \mu \ln{V_{i}} + \alpha \ln{W_{j}} - \beta \ln{d_{ij}} + \epsilon \quad &(8a) \\
\\
& Exponential-function \\
&\ln{T_{ij}} = k + \mu \ln{V_{i}} + \alpha \ln{W_{j}} - \beta {d_{ij}} + \epsilon \quad &(8b) \\
\end{align}
\]
%
where \(\epsilon\) is a a normally distributed error term with a mean of
0. The only difference between equations (8a) and (8b) is the functional
distance-decay specification, which results from plugging either
equation (6) for a power function or (7) for an exponential function
into equation (2) before linearizing it. The only practical difference
here is that the distance is logged in equation (8a) whereas in equation
(8b) it is not. Constrained spatial interaction models can be achieved
by including fixed effects for the origins (production-constrained),
fixed effects for the destinations (attraction-constrained) or both
(doubly-constrained). However, there are several limitations of the
log-normal gravity model, which include,

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\itemsep1pt\parskip0pt\parsep0pt
\item
  flows are often counts of people or objects and should be modeled as
  discrete entities;
\item
  flows are often not normally distributed;
\item
  downward biased flow predictions due to producing estimates for the
  logarithm of flows instead of actual flows;
\item
  zero flows are problematic since the logarithm of zero is undefined.
\end{enumerate}

Therefore,  the Poisson log-linear
regression specification for the family of spatial interaction models was proposed \citetext{\citealp{flowerdew_method_1982}; \citealp{flowerdew_fitting_1988}}.
This specification assumes that the number of flows between \(i\) and
\(j\) is drawn from a Poisson distribution with mean,
\(\lambda_{ij} = T_{ij}\), where \(\lambda_{ij}\) is assumed to be
logarithmically linked to the linear combination of variables,

\[\ln{\lambda_{ij}} = k + \mu \ln V_{i} + \alpha \ln W_{j} - \beta \ln d_{ij}) \quad (9a)\]
%
and exponentiating both sides of the equation yields the unconstrained
Poisson log-linear gravity model,

\[T_{ij} = \exp(k + \mu \ln V_{i} + \alpha \ln W_{j} - \beta \ln d_{ij}) \quad (9b) \]
%
where equations (9a) and (9b) refer to the unconstrained model with a
power function distance-decay. As previously mentioned, using fixed
effects for the balancing factors in equations (3-5), the constrained
variants of the family of spatial interaction models can be specified
as,

\[
\begin{align}
&Production-constrained \\
&T_{ij} = \exp(k + \mu_{i} + \alpha \ln W_{j} - \beta \ln d_{ij}) \quad & (10) \\
\\
&Attraction-constrained \\
&T_{ij} = \exp(k + \mu \ln V_{i} + \alpha_{j} - \beta \ln d_{ij}) \quad & (11) \\
\\
&Doubly-constrained \\
&T_{ij} = \exp(k + \mu_{i} + \alpha_{j} - \beta \ln d_{ij}) \quad & (12) \\
\end{align}
\]
%
where \(\mu_{i}\) are origin fixed effects and \(\alpha_{i}\) are
destination fixed effects that achieve the same results as including
balancing factors \citep{tiefelsdorf_specification_1995}. Notice that $k$ is the estimated intercept and must be included in these log-linear models (equation 8-12) to ensure the total number of flows is conserved, despite not being included in the maximum entropy models where such conservation is implied. Similar to equation (8b), the exponential function
distance-decay can be specified in equation (9b, 10-12) by omitting the
logarithm associated with \(d_{ij}\). Using Poisson regression is more
representative of flows and satisfies limitations (1-2) and it also
alleviates limitations (3-4) since we no longer need to take the
logarithm of \(T_{ij}\). Using fixed effects within Poisson regression
to calibrate the doubly-constrained model also avoids the need for
iterative computation of the balancing factors that exists in other
calibration methods \citep{fotheringham_spatial_1989}.

Calibration of Poisson regression can be carried out within a
generalized linear modeling framework (GLM) using iteratively weighted
least squares (IWSL), which converges to the maximum likelihood
estimates for the parameter estimates \citep{nelder_generalized_1972}. To
maintain computational efficiency with increasingly larger spatial
interaction datasets, SpInt is built upon a custom GLM/IWLS routine that
leverages sparse data structures for the production-constrained,
attraction-constrained, and doubly-constrained models. As the number of
locations in these models increases, so the does the number of binary
indicator variables needed to construct the fixed effects that enforce
the constraints. Therefore, larger spatial interaction datasets become
increasingly sparse and the utilization of sparse data structures takes
advantage of this feature. As a metric, constrained models with
\(n = m = 3,000\) locations, which implies \(n*m = n^2 = 9,000,000\)
observed flows when each location is an origin and destination, can be
calibrated within minutes on a standard macbook pro notebook.

    \subsection{Model fit statistics}\label{model-fit-statistics}

    In order to evaluate the fit of spatial interaction models, it has been
recommended that a variety of statistics be used \citep{knudsen_matrix_1986}, which is the approach taken in SpInt. For the
log-normal regression specification, it is popular to utilize the
coefficient of determination (\(R^2\)), though this statistic is not
available within the GLM framework used by SpInt. In replacement of the
\(R^2\) statistic, the SpInt framework provides a pseudo \(R^2\) based
on the likelihood function \citep{mcfadden_conditional_1974},
%
\[R^2_{pseudo} = 1 - \frac{\ln \hat{L}(M_{full})}{\ln \hat{L}(M_{Intercept})} \quad(13)\]
%
where \(\hat{L}\) is the likelihood of an estimated model, \(M_{full}\)
is the model including all explanatory variables of interest, and
\(M_{Intercept}\) is the model with only an intercept (i.e., no
covariates). Like the \(R^2\) statistic, the pseudo version is at a
maximum at a value of 1 with higher values denoting better model fit. To
account for model complexity, there is also an adjusted version of this
statistic,
%
\[R^2_{adj-pseudo} = 1 - \frac{\ln \hat{L}(M_{full}) - K}{\ln \hat{L}(M_{Intercept})} \quad(14)\]
%
where \(K\) is the number of regressors. If model fit does not
sufficiently improve, then it is possible for this measure to decrease
as variables are added, signaling that the additional variables do not
contribute towards a better model fit. Henceforth, these pseudo \(R^2\)
statistics are referred to solely as \(R^2\) and adjusted \(R^2\).
Another model fit statistic available in the SpInt module that also
accounts for model complexity is the the Akaike information criterion
(AIC),
%
\[ AIC = -2\ln \hat{L}(M_{full}) + 2K  \quad(15)\]
%
where lower AIC values indicate a better model fit \citep{akaike_new_1974}. This
statistic is grounded in information theory, whereby the AIC is an
asymptotic estimate of the information that is lost by using the full
model to represent a given theoretical process.

The \(R^2\) and AIC are designed for model selection, which means
they should not be used to compare between different spatial systems.
One solution to this issue is the standardized root mean square error
(SRMSE),
%
\[ SRMSE = \frac{\frac{\sqrt{\sum_{i}\sum_{j}(T_{ij} - \hat{T}_{ij})^{2}}}{n*m}}{\frac{\sum_{i}\sum_{j}T_{ij}}{n*m}} \quad(16)\]
%
where the numerator is the root mean square error of the observed
flows, \(T_{ij}\), and the flows predicted by the model,
\(\hat{T}_{ij}\), and the denominator is the mean of the observed flows
and is responsible for standardization of the statistic. Here, \(n*m\)
is the number of origin-destination pairs that constitute the system of
flows. A SRMSE value of 0 indicates perfect model fit, while higher
values indicate decreasing model fit; however, the upper limit of the
statistic is not necessarily 1 and will depend on the distribution of
the observed values \citep{knudsen_matrix_1986}.

One final fit statistic, a modified Sorensen similarity index (SSI), is
included within the SpInt module because it has become increasingly
popular in some spatial interaction literature that deals with
non-parametric models \citetext{\citealp{lenormand_universal_2012}; \citealp{masucci_gravity_2012}; \citealp{yan_universal_2013}}. Using the same symbol definition from the SRMSE, the SSI
is defined as,
%
\[ SSI = \frac{1}{(n*m)} \sum_{i} \sum_{j} \frac{2min(T_{ij}, \hat{T}_{ij})}{T_{ij} + \hat{T}_{ij}} \quad(17)\]
%
which is bounded between values of 0 and 1 with values closer to 1
indicating a better model fit.

    \section{An illustrative example: migration in
Austria}\label{an-illustrative-example-migration-in-austria}

    \subsection{The data}\label{the-data}

    Despite being a small toy dataset, the following example is utilized for
consistency since it was previously used to demonstrate spatial
interaction modeling in the R programming language \citep{dennett_estimating_2012}. The
data are migration flows between Austrian NUTS level 2 municipalities in
2006. In order to use a regression-based calibration, the data has to be
transformed from the matrices and vectors described in equations (1-5)
to a table where each row represents a single origin-destination dyad,
\((i,j)\) and any variables associated with locations \(i\) and \(j\).
Details on how to do this are outlined further in \citep{lesage_spatial_2008}, though this has already been done in the example data. Let's have
a look!

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}19}]:} \PY{k+kn}{import} \PY{n+nn}{pandas} \PY{k+kn}{as} \PY{n+nn}{pd}
         \PY{k+kn}{import} \PY{n+nn}{geopandas} \PY{k+kn}{as} \PY{n+nn}{gp}
         \PY{o}{\PYZpc{}}\PY{k}{pylab} inline
         \PY{n}{austria\PYZus{}shp} \PY{o}{=} \PY{n}{gp}\PY{o}{.}\PY{n}{read\PYZus{}file}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{austria.shp}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{austria\PYZus{}shp}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{p}{)}
         \PY{n}{austria} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{read\PYZus{}csv}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{austria.csv}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{austria}\PY{o}{.}\PY{n}{head}\PY{p}{(}\PY{p}{)}
\end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
Populating the interactive namespace from numpy and matplotlib

    \end{Verbatim}

            \begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}19}]:}    Unnamed: 0 Origin Destination  Data    Oi     Dj            Dij
         0           0   AT11        AT11     0  4016   5146  1.000000e-300
         1           1   AT11        AT12  1131  4016  25741   1.030018e+02
         2           2   AT11        AT13  1887  4016  26980   8.420467e+01
         3           3   AT11        AT21    69  4016   4117   2.208119e+02
         4           4   AT11        AT22   738  4016   8634   1.320075e+02
\end{Verbatim}
        
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{SpIntPrimer_files/SpIntPrimer_13_2.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    The \textbf{Origin} and \textbf{Destination} columns refer to the
labels for origin locations, \(i\), and the labels for destination locations, \(j\),
the \textbf{Data} column is the number of flows between $i$ and $j$, the \textbf{Oi} and
\textbf{Dj} columns are the number of total out-flows at $i$ and total
in-flows at $j$, respectively, and the \textbf{Dij} column is the Euclidian
distance between the centroids of \(i\) and \(j\). In this case we use
the total out-flow and total in-flow as variables to describe how
emissive an origin is and how attractive a destination is. If we want a
more informative and interesting model we can replace these with
application specific variables that pertain to different hypotheses.
Next, lets format the data into arrays.

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}4}]:} \PY{n}{austria} \PY{o}{=} \PY{n}{austria}\PY{p}{[}\PY{n}{austria}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Origin}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{!=} \PY{n}{austria}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Destination}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{]}
        \PY{n}{flows} \PY{o}{=} \PY{n}{austria}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Data}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{values}
        \PY{n}{Oi} \PY{o}{=} \PY{n}{austria}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Oi}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{values}
        \PY{n}{Dj} \PY{o}{=} \PY{n}{austria}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Dj}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{values}
        \PY{n}{Dij} \PY{o}{=} \PY{n}{austria}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Dij}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{values}
        \PY{n}{Origin} \PY{o}{=} \PY{n}{austria}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Origin}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{values}
        \PY{n}{Destination} \PY{o}{=} \PY{n}{austria}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Destination}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{values}
\end{Verbatim}

    The Oi and Dj vectors need not be \(n^2 \times 1\) arrays. In fact,
they can be \(n^2 \times k\) where \(k\) is the number of variables that
are being used to describe either origin or destination attributes
associated with flows. It should also be noted that intra-zonal flows
have been excluded (the first line of code above). This is sometimes
done because intra-zonal flows are large compared to inter-zonal flows
and would therefore heavily influence the model or because it is not
possible to adequately define a distance associated with intra-zonal
flows. Some solutions to these issues have been proposed \citetext{\citealp{kordi_possible_2012}; \citealp{tsutsumi_intraregional_2011}}, though for simplicity, intra-zonal
were removed for this example. 

    \subsection{Calibrating the models}\label{calibrating-the-models}

    Now, lets load the main SpInt functionality and calibrate some models. The
``family'' of spatial interaction models are found within the \textbf{gravity} namespace of the SpInt
module and the estimated parameters can be accessed via the
\textbf{params} attribute of a successfully instantiated spatial
interaction model.

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}5}]:} \PY{k+kn}{from} \PY{n+nn}{pysal.contrib.spint.gravity} \PY{k+kn}{import} \PY{n}{Gravity}
        \PY{k+kn}{from} \PY{n+nn}{pysal.contrib.spint.gravity} \PY{k+kn}{import} \PY{n}{Production}
        \PY{k+kn}{from} \PY{n+nn}{pysal.contrib.spint.gravity} \PY{k+kn}{import} \PY{n}{Attraction}
        \PY{k+kn}{from} \PY{n+nn}{pysal.contrib.spint.gravity} \PY{k+kn}{import} \PY{n}{Doubly}
\end{Verbatim}

    Unconstrained (basic gravity) model

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}6}]:} \PY{n}{gravity} \PY{o}{=} \PY{n}{Gravity}\PY{p}{(}\PY{n}{flows}\PY{p}{,} \PY{n}{Oi}\PY{p}{,} \PY{n}{Dj}\PY{p}{,} \PY{n}{Dij}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{exp}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
        \PY{k}{print} \PY{n}{gravity}\PY{o}{.}\PY{n}{params}
\end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
[ -8.01822841e+00   8.69316127e-01   8.91445153e-01  -6.22938370e-03]

    \end{Verbatim}

    Production-constrained model

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}7}]:} \PY{n}{production} \PY{o}{=} \PY{n}{Production}\PY{p}{(}\PY{n}{flows}\PY{p}{,} \PY{n}{Origin}\PY{p}{,} \PY{n}{Dj}\PY{p}{,} \PY{n}{Dij}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{exp}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
        \PY{k}{print} \PY{n}{production}\PY{o}{.}\PY{n}{params}\PY{p}{[}\PY{o}{\PYZhy{}}\PY{l+m+mi}{2}\PY{p}{:}\PY{p}{]}
\end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
[ 0.90285448 -0.0072617 ]

    \end{Verbatim}

    Attraction-constrained model

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}8}]:} \PY{n}{attraction} \PY{o}{=} \PY{n}{Attraction}\PY{p}{(}\PY{n}{flows}\PY{p}{,} \PY{n}{Destination}\PY{p}{,} \PY{n}{Oi}\PY{p}{,} \PY{n}{Dij}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{exp}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
        \PY{k}{print} \PY{n}{attraction}\PY{o}{.}\PY{n}{params}\PY{p}{[}\PY{o}{\PYZhy{}}\PY{l+m+mi}{2}\PY{p}{:}\PY{p}{]}
\end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
[ 0.90037216 -0.00695034]

    \end{Verbatim}

    Doubly-constrained model

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}9}]:} \PY{n}{doubly} \PY{o}{=} \PY{n}{Doubly}\PY{p}{(}\PY{n}{flows}\PY{p}{,} \PY{n}{Origin}\PY{p}{,} \PY{n}{Destination}\PY{p}{,} \PY{n}{Dij}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{exp}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
        \PY{k}{print} \PY{n}{doubly}\PY{o}{.}\PY{n}{params}\PY{p}{[}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{:}\PY{p}{]}
\end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
[-0.00791533]

    \end{Verbatim}
%
Note that for the above examples the print statement for the constrained models params attribute is limited to print only the main model variables (i.e., not fixed
effects), though it is still possible to access the fixed effect
parameters too.

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}10}]:} \PY{k}{print} \PY{n}{production}\PY{o}{.}\PY{n}{params}
\end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
[-1.16851884  1.68980685  2.15135947  0.59917703  0.88336198  1.20669895
  0.68945769  1.15434225  1.01013674  0.90285448 -0.0072617 ]

    \end{Verbatim}

    The first parameter is always the overall intercept with the subsequent
8 parameters representing the fixed effects in this case. You might ask,
``why not 9 fixed effects for the 9 different municipalities?''. Due to
the coding scheme used in SpInt, and many popular statistical
programming languages, you would use \(n - 1\) binary indicator
variables in the design matrix to include the fixed effects for all 9
municipalities in the model. While the non-zero entries in these columns
of the design matrix indicate which rows are associated with which
municipality, where a row has all zero entries then implicitly refers
to the \(n\)th municipality that has been left out. In Spint, this is
always the first origin or destination for the production-constrained
and attraction-constrained models. For the doubly-constrained model,
both the first origin and the first destination are left out
\citep{tiefelsdorf_specification_1995}. In terms of interpreting the parameters,
these dropped locations are assumed to be 0. 

You can also access typical model diagnostics, such as standard errors (\textbf{std\_err}), $t$-values (\textbf{tvalues}), $p$-values (\textbf{pvalues}), and confidence intervals (\textbf{cont\_int}).

%Since the fixed effects parameters are interpreted as deviations from the overall intercept, this essentially means the intercept acts as the fixed effect for the first origin and/or destination, depending on which constrained model is calibrated. Said differently, the fixed effect for the first origin and/or destination serves as the overall intercept.

    \subsection{Interpreting the
parameters}\label{interpretting-the-parameters}

    First, it will be demonstrated how to interpret the coefficients
associated with the main model variables from a general Poisson
regression. However, because the spatial interaction model is a
log-linear Poisson regression (i.e., we take the log of the explanatory
variables) the same interpretation often cannot be applied because we are
working in logarithmic space. Therefore, it will also be demonstrated
how to interpret the parameters when they are associated with a logged
explanatory variable.

Recall from the previous section that the exponential distance-decay
specification results in a model that does not take the logarithm of
\(d_{ij}\). Therefore, we can use an unconstrained gravity model with an
exponential distance-decay specification to demonstrate a typical
interpretation of coefficients from a Poisson regression.

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}11}]:} \PY{n}{gravity} \PY{o}{=} \PY{n}{Gravity}\PY{p}{(}\PY{n}{flows}\PY{p}{,} \PY{n}{Oi}\PY{p}{,} \PY{n}{Dj}\PY{p}{,} \PY{n}{Dij}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{exp}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{k}{print} \PY{n}{gravity}\PY{o}{.}\PY{n}{params}
\end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
[ -8.01822841e+00   8.69316127e-01   8.91445153e-01  -6.22938370e-03]

    \end{Verbatim}
%
-6.22938370e-03 is the coefficient for the distance variable in the
above example. In Poisson regression, the coefficients are typically
interpreted as the proportionate change in the predicted response, here
\(T_{ij}\), if we increase an explanatory variable by 1 unit \citep{cameron_regression_2013}. Technically, this is expressed as,
%
\[ \tilde{T}_{ij} = T_{ij}* \exp(\beta) \quad (18)\]
%
where \(\tilde{T}_{ij}\) is the new value of \(T_{ij}\) and \(\beta\) is
a coefficient, here the one typically associated with distance in a
Poisson log-linear spatial interaction model with an exponential
function distance-decay. For this example, this means from a 1 unit
increase in distance, holding all other factors constant, if our model predicted 2,500 flows, then we can
expect the number of flows to decrease to approximately 2,484.475. We
can also identify the percent change expected from a one unit increase
in distance using,
%
\[\Delta_{\%} = (1-exp(\beta))*100.0 \quad (19)\]
%
which serves as an alternative interpretation of \(\beta\). In this case,
we could say that from a 1 unit increase in distance we could expect the
number of predicted flows to decrease by approximately 0.621\%.

However, neither equation (19) or (20) is applicable when the
coefficient is associated with a logged explanatory variable. This is
important for Poisson log-linear spatial interaction models because this
applies to the origin and destination variables when using an
exponential function of distance-decay and to the origin, destination,
and distance variables when using a power function of distance-decay. In
these cases, the interpretation of the coefficients becomes the percent
change in the predicted response, here \(T_{ij}\), if we increase the
associated explanatory variable by 1\% \citep{cameron_regression_2013}. For
example, 8.91445153e-01 is the coefficient associated with destination
total in-flows (i.e., attractiveness) in the above example. Then if we
increase the in-flows to location \(j\) by 1\%, say from \(25,000\) to
\(25,250\), and holding all other factors constant, we can expect the number of flows from \(i\) to \(j\) (i.e.,
\(T_{ij}\)) to increase from \(2,000\) to \(2,020\).\footnotemark

\footnotetext{This example is only illustrative. Of course, if we increased the total in-flows, this would imply that we are also increasing the total out-flows from somewhere else and therefore the system could not truly be held constant. However, substantive modeling calls for origin and destination variables that are not derived from the interaction matrix. Therefore, this is not an issue in practice when there is the assumption of independence between flows. However, it has been hypothesized that flows may not be independent and therefore more accurate estimates can be obtained using more advanced methods \citetext{\citealp{lesage_spatial_2008}; \citealp{chun_modeling_2008}}.}

Finally, the fixed effects in the constrained models can be interpreted
such that the mean predicted flows, \(T_{ij}\), are \(e^{\mu_{i}}\)
(\(e^{\alpha_{j}}\)) times larger if they originate (terminate) from
location \(i\) (location \(j\)) \citep{cameron_regression_2013}, where
\(e^{\mu_{i}}\) is equivalent notation for \(\exp(\mu_{i})\).

    \subsection{Assessing model fit}\label{assessing-model-fit}

    We can compare the different model fit statistics across the four types
of spatial interaction models for this example. Let's process the
statistics into a tidy table and have a look.
\\
\\
\\
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}12}]:} \PY{n}{R2}\PY{p}{,} \PY{n}{adjR2}\PY{p}{,} \PY{n}{SSI}\PY{p}{,} \PY{n}{SRMSE}\PY{p}{,} \PY{n}{AIC} \PY{o}{=} \PY{p}{[}\PY{p}{]}\PY{p}{,} \PY{p}{[}\PY{p}{]}\PY{p}{,} \PY{p}{[}\PY{p}{]}\PY{p}{,} \PY{p}{[}\PY{p}{]}\PY{p}{,} \PY{p}{[}\PY{p}{]}
         \PY{n}{model\PYZus{}name} \PY{o}{=} \PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{grav}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{prod}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{att}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{doub}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
         \PY{n}{col\PYZus{}names} \PY{o}{=} \PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{R2}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{adjR2}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{AIC}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{SRMSE}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{SSI}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
         \PY{n}{models} \PY{o}{=} \PY{p}{[}\PY{n}{gravity}\PY{p}{,} \PY{n}{production}\PY{p}{,} \PY{n}{attraction}\PY{p}{,} \PY{n}{doubly}\PY{p}{]}
         
         \PY{k}{for} \PY{n}{model} \PY{o+ow}{in} \PY{n}{models}\PY{p}{:}
             \PY{n}{R2}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{model}\PY{o}{.}\PY{n}{pseudoR2}\PY{p}{)}
             \PY{n}{adjR2}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{model}\PY{o}{.}\PY{n}{adj\PYZus{}pseudoR2}\PY{p}{)}
             \PY{n}{SSI}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{model}\PY{o}{.}\PY{n}{SSI}\PY{p}{)}
             \PY{n}{SRMSE}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{model}\PY{o}{.}\PY{n}{SRMSE}\PY{p}{)}
             \PY{n}{AIC}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{model}\PY{o}{.}\PY{n}{AIC}\PY{p}{)}
         
         \PY{n}{cols} \PY{o}{=} \PY{p}{\PYZob{}}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{model\PYZus{}name}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{n}{model\PYZus{}name}\PY{p}{,}
                 \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{R2}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{n}{R2}\PY{p}{,} 
                 \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{adjR2}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{n}{adjR2}\PY{p}{,} 
                 \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{SSI}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{n}{SSI}\PY{p}{,} 
                 \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{SRMSE}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{n}{SRMSE}\PY{p}{,} 
                 \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{AIC}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{n}{AIC} \PY{p}{\PYZcb{}}
         
         \PY{n}{data} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{p}{(}\PY{n}{cols}\PY{p}{)}\PY{o}{.}\PY{n}{set\PYZus{}index}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{model\PYZus{}name}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{data}\PY{p}{[}\PY{n}{col\PYZus{}names}\PY{p}{]}
\end{Verbatim}

            \begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}12}]:}                   R2     adjR2           AIC     SRMSE       SSI
         model\_name                                                      
         grav        0.885764  0.885718  20122.074349  0.607776  0.727358
         prod        0.910156  0.910031  15841.253799  0.464520  0.740914
         att         0.909355  0.909230  15982.313101  0.584048  0.752155
         doub        0.943540  0.943335   9977.159141  0.379286  0.811852
\end{Verbatim}
 %       
From this table we can see that all of the fit statistics indicate a
better model fit as constraints are introduced. That is, the weakest
model fit is consistently related to the gravity model, with similarly
increased model fit for the production-constrained and
attraction-constrained models, and finally, the best model fit is
associated with the doubly constrained model. We can also see that the
\(R^2\) and adjusted \(R^2\) are very close, since these models have a
very similar number of explanatory variables, thereby resulting in
little or no penalization for model complexity.

We can also take a look at whether the power or exponential
distance-decay specification results in a better model fit. For
simplicity, lets just take a look at the SRMSE for a doubly constrained
model.

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}13}]:} \PY{k}{print} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{SRMSE for exp distance\PYZhy{}decay: }\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{doubly}\PY{o}{.}\PY{n}{SRMSE}
         \PY{n}{pow\PYZus{}doubly} \PY{o}{=} \PY{n}{Doubly}\PY{p}{(}\PY{n}{flows}\PY{p}{,} \PY{n}{Origin}\PY{p}{,} \PY{n}{Destination}\PY{p}{,} \PY{n}{Dij}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{pow}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{k}{print} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{SRMSE for exp distance\PYZhy{}decay: }\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{pow\PYZus{}doubly}\PY{o}{.}\PY{n}{SRMSE}
\end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
SRMSE for exp distance-decay:  0.37928618533
SRMSE for exp distance-decay:  0.277703139642

    \end{Verbatim}
%
    For this example, it looks like the power distance-decay specification
results in a better model fit.

    \subsection{Local models}\label{local-models}

    The SpInt module also makes it possible to calibrate ``local'' models,
which subset the data by specific origins or destinations in order o
investigate how spatial interaction processes vary over space
\citep{fotheringham_local_1999}. Below is an example of how to get
local parameters and local diagnostics for a gravity model subset by its
origins. The result is a dictionary of lists where the keys are the
different sets of local values including parameters, hypothesis testing
diagnostics, and the previously reviewed fit statistics.

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}14}]:} \PY{n}{gravity} \PY{o}{=} \PY{n}{Gravity}\PY{p}{(}\PY{n}{flows}\PY{p}{,} \PY{n}{Oi}\PY{p}{,} \PY{n}{Dj}\PY{p}{,} \PY{n}{Dij}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{pow}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{local\PYZus{}gravity} \PY{o}{=} \PY{n}{gravity}\PY{o}{.}\PY{n}{local}\PY{p}{(}\PY{n}{Origin}\PY{p}{,} \PY{n}{np}\PY{o}{.}\PY{n}{unique}\PY{p}{(}\PY{n}{Origin}\PY{p}{)}\PY{p}{)}
\end{Verbatim}
%
    Lets take a look at the local distance-decay parameters. The origin,
destination and distance-decay parameters are indexed sequentially
through the design matrix starting with 0 as you move through the origin
attributes, through to the destination attributes, and finally the
distance-decay attribute. Therefore, for \(n\) variables, the
distance-decay parameters are always the $n-1^{th}$ parameter, in this
case of 3 variables: \textbf{param2}.

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}15}]:} \PY{k}{print} \PY{n}{np}\PY{o}{.}\PY{n}{round}\PY{p}{(}\PY{n}{local\PYZus{}gravity}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{param2}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,} \PY{l+m+mi}{4}\PY{p}{)}
\end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
[-3.4028 -1.3583 -0.8307 -1.1492 -0.4781 -1.0095 -1.6758 -1.2156 -1.5397]

    \end{Verbatim}
%
    We can also take a look at the local \(R^2\).

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}16}]:} \PY{k}{print} \PY{n}{np}\PY{o}{.}\PY{n}{round}\PY{p}{(}\PY{n}{local\PYZus{}gravity}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{pseudoR2}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,} \PY{l+m+mi}{4}\PY{p}{)}
\end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
[ 0.9665  0.9894  0.9893  0.5205  0.676   0.7298  0.6333  0.432   0.515 ]

    \end{Verbatim}
%
    Both the local distance-decay and the \(R^2\) show some variation. We
can explore this spatially, by mapping the local values. First, lets
join the local values to a shapefile and then plot the local
distance-decay parameters

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}17}]:} \PY{c+c1}{\PYZsh{}Join local values to census tracts}
         \PY{n}{local\PYZus{}vals} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{p}{(}\PY{p}{\PYZob{}}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{betas}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{n}{local\PYZus{}gravity}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{param2}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,} 
                                    \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Dest}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:}\PY{n}{np}\PY{o}{.}\PY{n}{unique}\PY{p}{(}\PY{n}{Origin}\PY{p}{)}\PY{p}{,} 
                                    \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{pseudoR2}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{n}{local\PYZus{}gravity}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{pseudoR2}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{\PYZcb{}}\PY{p}{)}
         \PY{n}{local\PYZus{}vals} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{merge}\PY{p}{(}\PY{n}{local\PYZus{}vals}\PY{p}{,} \PY{n}{austria\PYZus{}shp}\PY{p}{[}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{NUTS\PYZus{}ID}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{geometry}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{]}\PY{p}{,}
                               \PY{n}{left\PYZus{}on}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Dest}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{right\PYZus{}on}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{NUTS\PYZus{}ID}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{local\PYZus{}vals} \PY{o}{=} \PY{n}{gp}\PY{o}{.}\PY{n}{GeoDataFrame}\PY{p}{(}\PY{n}{local\PYZus{}vals}\PY{p}{)}
         
         \PY{c+c1}{\PYZsh{}Plot betas \PYZhy{} use inverse so the most negative values are \PYZdq{}higher\PYZdq{}}
         \PY{n}{fig} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{p}{)}
         \PY{n}{ax} \PY{o}{=} \PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}subplot}\PY{p}{(}\PY{l+m+mi}{111}\PY{p}{)}
         \PY{n}{local\PYZus{}vals}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{inv\PYZus{}betas}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{p}{(}\PY{n}{local\PYZus{}vals}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{betas}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{*}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{)}
         \PY{n}{local\PYZus{}vals}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{inv\PYZus{}betas}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{cmap}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Blues}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{ax}\PY{o}{=}\PY{n}{ax}\PY{p}{)}
\end{Verbatim}

            \begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}17}]:} <matplotlib.axes.\_subplots.AxesSubplot at 0x115da9fd0>
\end{Verbatim}
        
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{SpIntPrimer_files/SpIntPrimer_49_1.png}
    \end{center}
    { \hspace*{\fill} \\}
%   
    Next, lets map the local \(R^2\) values. Above we can see a much
stronger distance-decay for the most westerly municipality. Below we can
see that the model fit is stronger in the north-west and decreases in the
south-east. Using these patterns, we could then further postulate why
they arise or how we might be able to improve model fit.

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}18}]:} \PY{n}{fig} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{p}{)}
         \PY{n}{ax} \PY{o}{=} \PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}subplot}\PY{p}{(}\PY{l+m+mi}{111}\PY{p}{)}
         \PY{n}{local\PYZus{}vals}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{pseudoR2}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{cmap}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Greens}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{ax}\PY{o}{=}\PY{n}{ax}\PY{p}{)}
\end{Verbatim}

            \begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}18}]:} <matplotlib.axes.\_subplots.AxesSubplot at 0x116f3b9d0>
\end{Verbatim}
        
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{SpIntPrimer_files/SpIntPrimer_51_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \section*{Further functionality}\label{further-functionality}

    In addition to all of the features presented here, there are several
other tools that exist in SpInt or could be added. First, there are
dispersion tests available in the \textbf{dispersion} namespace of the
SpInt module, which can be used to test whether or not the Poisson
equidispersion assumption is met. That is, that the conditional mean
and variance are equivalent, which can be unrealistic in many scenarios.
If these tests indicate overdispersion or underdispersion, then it might
be appropriate to use a Quasi-Poisson model, which relaxes the
equidispersion assumption of the Poisson model. The resulting parameter
estimates are equivalent to the Poisson model, but the standard errors
are typically larger whenever equidispersion does not hold \citep{wedderburn_quasi-likelihood_1974}. The Quasi-Poisson model specification can be carried out by
setting \textbf{Quasi=True} in any of the spatial interaction models introduced here. Alternatively, it might be more appropriate to change the
underlying probability model from Poisson to that of negative binomial
or a zero-inflated model. However, this has not yet been implemented in
SpInt and therefore remains as future work.

Another area of potential expansion is to accommodate several paradigms for
incorporating spatial effects into spatial interaction models, such as
competing destinations \citep{fotheringham_new_1983}, a spatial lag
autoregressive model \citep{lesage_spatial_2008}, or an eigenvector spatial
filter model \citep{chun_modeling_2008}. These paradigms require code that computes
additional variables, more complex calibration techniques, and specialized
representations of spatial relationships. Some solutions to the
latter are available in the \textbf{spintW} namespace of the
\textbf{weights} module of PySAL. While there is still much work to be done to
develop a more robust set of open source spatial interaction modeling tools, SpInt provides a starting point for which to build upon.



    % Add a bibliography block to the postdoc
    \bibliography{primer}
    \bibliographystyle{apa}
    
    
    
    \end{document}
